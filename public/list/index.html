<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>List</title>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>

<!--
Обязательно должен быть компонент, внутрь которого вы внедрите корневой компонент React
Далее у этого компонента могут быть уже внутренние компоненты
-->
<div id="root"></div>

</body>
<script type="text/babel">
    //  общий контейнер для поиска и отображения
    function FilterableProductTable({products}) {

        // если эти значения будут изменяться, то будет происходить авто перерисовка компонентов, которые их используют
        // поэтому нужно быть внимательным и следить за всеми местами в коде, где изменяете эти значения!
        const [inStockOnly, setInStockOnly] = React.useState(false);

        // при каждой отрисовке компонента - будут считывать переменные из состояния и фильтровать данные
        const filteredProducts = [];

        products.forEach((product) => {

            // будет ли добавлен товар для отображения
            var canAdd = true;

            // фильтруем по переключателю (в наличии или нет)
            if (inStockOnly && !product.stocked) {
                canAdd = false;
            }

            if (canAdd) {
                filteredProducts.push(product);
            }
        });

        console.log(filteredProducts);
        return (
            <div>
                <SearchBar
                    inStockOnly={inStockOnly} // поставить галочку или нет в дочернем компоненте
                    onInStockOnlyChange={setInStockOnly} // ссылка на метод

                />
                <ProductTable products={filteredProducts}/>
            </div>
        );
    }

    // область поиска (влияет на данные таблицы).
    // важно! компонент не должен изменять входящие свойства, а только вызывать callback методы,
    // чтобы родительский компонент смог использовать измененные значения
    function SearchBar({
                           inStockOnly: inStockOnly, // только для чтения (read-only) - будет ли нажата галочка при отображении
                           onInStockOnlyChange       // callback метод для обработки в родительском компоненте (при нажатии на галочку)
                       }) {
        return (
            <>

                <div>
                    Показать только в наличии
                    <input type="checkbox" id="box"
                           checked={inStockOnly}
                           onChange={(e) => onInStockOnlyChange(e.target.checked)}
                    />


                </div>
            </>
        );
    }

    // таблица с данными товаров
    function ProductTable({products}) {

        // массив React компонентов ProductRow
        const rows = [];

        let lastCategory = null;

        // проходим по всем продуктам и формируем из них React компонент ProductRow
        products.forEach((product) => {

            // отображение категории
            if (product.category !== lastCategory) { // если категория товаров изменилась - тогда отображаем ее
                rows.push(
                    <ProductCategoryRow
                        category={product.category}
                        key={product.category}/>
                );
            }

            // отображение товара в виде строки
            rows.push(
                <ProductRow
                    product={product}
                    key={product.name}/>
            );

            lastCategory = product.category;
        });

        return (
            <div>
                <table>
                    <thead>
                    <tr>
                        <th>Название</th>
                        <th>Цена (руб)</th>
                    </tr>
                    </thead>
                    <tbody>{rows}</tbody>
                </table>
            </div>
        );
    }

    // строка таблицы с названием категории (занимает всю строку)
    function ProductCategoryRow({category}) {
        return (
            <tr>
                <th colSpan="2">
                    {category}
                </th>
            </tr>
        );
    }

    // строка таблицы с информацией о товаре
    function ProductRow({product}) {
        // можем вернуть зачеркнутый тег с названием товара
        const name = product.stocked ? product.name :
            <s>
                {product.name}
            </s>;
        return (
            <tr>
                <td>{name}</td>
                <td>{product.price}</td>
            </tr>
        );
    }

    // данные можем получать по сети после запроса на backend
    // в нашем примере данные должны быть проинициализированы раньше, чем внедрение корневого компонента React
    // для упрощения - все товары упорядочены каждый в своей категории (и категории идут последовательно)
    const PRODUCTS = [
        {category: "Фрукты", price: "100", stocked: true, name: "Ананас"},
        {category: "Фрукты", price: "135", stocked: true, name: "Абрикос"},
        {category: "Фрукты", price: "200", stocked: false, name: "Яблоко"},
        {category: "Фрукты", price: "500", stocked: false, name: "Банан"},
        {category: "Овощи", price: "20", stocked: true, name: "Картофель"},
        {category: "Овощи", price: "85", stocked: false, name: "Помидор"},
        {category: "Овощи", price: "92", stocked: true, name: "Огурец"}
    ];

    // внедрение компонента на страницу
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FilterableProductTable products={PRODUCTS}/>);
</script>
</html>